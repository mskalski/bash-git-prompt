##############################################################################
# Theme adds tty name and full datetime to prompt and also have last 
# command status, error code is displayed only for errors >=2
#
# Also sets window title to contain debian-based title (user@host: workdir),
# and additionally tty name, HH:MM time, error marker and also DayTime marker
# (day/night) -- for signalling workaholics it's time go home :-)
#
# Samples:
#
# Prompt:
# -------
#
# [2018-10-31 12:09:10] ~/.bash-git-prompt [master (origin/master)| âœš1 â€¦1]
# user@host âœpts/27 [âœ”] $ 
#
# Window title:
# -------------
# âœ˜12:09 ğŸŒ user@host:~/.bash-git-prompt âœpts/27
#
##############################################################################

override_git_prompt_colors() {
  GIT_PROMPT_THEME_NAME="mskalski_WindowTitle"

  #Overrides the prompt_callback function used by bash-git-prompt
  function prompt_callback {

    local hour=`date '+%H'`
    local TimeMarker
    #local TimeColor
    #local TimeMarkerColor

    # Setup Time marker and colors to be different on night and day
    if [ $hour -lt 8 -o $hour -ge 17 ]; then
      TimeMarker='ğŸŒš'
      #TimeMarkerColor="${BrightBlue}"
      #TimeColor="${Magenta}"
    else
      TimeMarker='ğŸŒ'
      #TimeMarkerColor="${Yellow}"
      #TimeColor="${BrightBlue}"
    fi
    
    # [WiP] to make TimeMarker work in regular prompt
    #local gp_time="${TimeColor}[${TimeMarkerColor}${TimeMarker} ${TimeColor}${TimeFull}]"
    
    #GIT_PROMPT_START_USER="\\n${gp_time} ${BrightCyan}${PathShort}"
    #GIT_PROMPT_START_ROOT="\\n${gp_time} ${BrightYellow}${PathShort}"

    local Title="${Time12a} ${TimeMarker} \u@\h:$(gp_truncate_pwd) âœ$TTYName"
    
    if [ "${GIT_PROMPT_LAST_COMMAND_STATE:-0}" != 0 ]; then
      Title="âœ˜$Title"
    fi

    gp_set_window_title "$Title"
    
    #echo "[e: $BASHPID]" 1>&2
    #echo "[o: $BASHPID]"
  }
  
  function _filter_error_status {
    status=$?
    
    [ $# -gt 0 ] && status="$1"
    
    case "$status" in
      0|1) ;;
      *) echo -$status;;
    esac
  }
  
  # Full time 
  TimeFull="\$(date +'%Y-%m-%d %H:%M:%S')"
  TTYName="\$(tty | sed 's:^/dev/::')"
  #HostName='\h'
  HostName=${HOSTNAME:-`hostname`}

  local gp_time="${BoldBlue}[${TimeFull}]"
  local gp_user_prompt='\$'

  GIT_PROMPT_CLEAN=" ${BoldGreen}âœ”"
  GIT_PROMPT_STAGED=" ${BrightYellow}â–" # the number of staged files/directories
  GIT_PROMPT_STASHED=" ${BoldMagenta}âš‘" # the number of stashed files
  GIT_PROMPT_CONFLICTS=" ${Red}âœ–"       # the number of files in conflict
  GIT_PROMPT_CHANGED=" ${BoldBlue}âœš"    # the number of changed files
  GIT_PROMPT_UNTRACKED=" ${DimWhite}â€¦"  # the number of untracked files

  GIT_PROMPT_REMOTE=""
  # the git branch that is active in the current directory
  GIT_PROMPT_BRANCH="${Magenta}"
  # used if the git branch that is active in the current directory is $GIT_PROMPT_MASTER_BRANCHES
  GIT_PROMPT_MASTER_BRANCH="${BoldGreen}"
  GIT_PROMPT_UPSTREAM=" {${BoldBlue}_UPSTREAM_${ResetColor}}"
  #GIT_UPSTREAM_PRIVATE=''

  GIT_PROMPT_COMMAND_OK="${Green}[âœ”]"
  GIT_PROMPT_COMMAND_FAIL="${Red}[âœ˜\$(_filter_error_status \${GIT_PROMPT_LAST_COMMAND_STATE})]"

  GIT_PROMPT_START_USER="\\n${gp_time} ${BrightCyan}${PathShort}"
  GIT_PROMPT_START_ROOT="\\n${gp_time} ${BrightYellow}${PathShort}"

  GIT_PROMPT_END_USER="\\n${BrightGreen}\\u@${HostName} ${Yellow}âœ${TTYName} _LAST_COMMAND_INDICATOR_ ${ResetColor}${gp_user_prompt}${ResetColor} "
  GIT_PROMPT_END_ROOT="\\n${BrightRed}\\u@${HostName} ${Yellow}âœ${TTYName} _LAST_COMMAND_INDICATOR_ ${ResetColor}${gp_user_prompt}${ResetColor} "

  #GIT_PROMPT_LEADING_SPACE=1
  GIT_PROMPT_PREFIX="${Cyan}["
  GIT_PROMPT_SUFFIX="${Cyan}]"
  GIT_PROMPT_SYMBOLS_AHEAD="${BrightGreen} â–²"  # The symbol for "n versions ahead of origin"
  GIT_PROMPT_SYMBOLS_BEHIND="${BrightRed} â–¼"   # The symbol for "n versions behind of origin"
  GIT_PROMPT_SYMBOLS_PREHASH="${Yellow}:"     # Written before hash of commit, if no name could be found
  GIT_PROMPT_SYMBOLS_NO_REMOTE_TRACKING="${BrightYellow}âœ³"

}

reload_git_prompt_colors "mskalski_WindowTitle"

# Useful Unicode characters
# Checkmarks: âœ“âœ” âœ•âœ–âœ—âœ˜ â“â” âŒâœ…
# Emoticons:  â˜¹â˜ºâ˜»â™‰â˜†â˜ 
# Sun:        â˜€â˜¼â›…â›¯ğŸŒğŸŒ£ğŸŒ£ğŸŒ¤ğŸŒ…ğŸŒ„â›­â›¯â›®
# Moon:       â˜¾â˜½ğŸŒğŸŒœğŸŒ›ğŸŒšğŸŒ™ğŸŒ˜ğŸŒ—ğŸŒ–ğŸŒ•ğŸŒ”ğŸŒ“ğŸŒ’ğŸŒ‘
# Stars:      â–âœªâœ±âœ²âœ³âœ¶âœ¼âœ»âœ½âœ¾âœ¿ ğŸŒ ğŸŒŸ
# Weather:    ğŸŒ¥ğŸŒ¦ğŸŒ§ğŸŒ¨ğŸŒ©ğŸŒªğŸŒ¢ğŸŒ¡â›ˆ
# Shapes:     â­•â¬¬â¬­â¬®â¬¯â¬¤â¯„â¯ƒâ¯‚â¯â¯€â¬©â¬¨â¬§â¬¦â¬¥â­â›¬â›šâ›¶â›¾â°â±â²â³î€€â­˜â­™â­—â­–â­•â¬¬â¬­â¬®â¬¯â¬¤â—
# Arrows:     â†“â†‘ğŸ¡¡ğŸ¡£ğŸ¡¢ğŸ¡ ğŸ¡‘ğŸ¡ğŸ¡’ğŸ¡“ğŸ¡”ğŸ¡•ğŸ¡–ğŸ¡—ğŸ¡˜ğŸ¡™ğŸ¡¤ğŸ¡¥ğŸ¡¦ğŸ¡§ğŸ¡¨ğŸ¡©ğŸ¡ªğŸ¡«ğŸ¡¬ğŸ¡­ğŸ¡®ğŸ¡¯ğŸ¡°ğŸ¡±ğŸ¡²ğŸ¡³ğŸ¡´ğŸ¡µğŸ¡¶ğŸ¡·ğŸ¡¸ğŸ¡¹ğŸ¡ºğŸ¡»ğŸ¡¼ğŸ¡½ğŸ¡¾ğŸ¡¿ğŸ¢€ğŸ¢ğŸ¢‚ğŸ¢ƒğŸ¢„ğŸ¢…ğŸ¢†ğŸ¢‡ğŸ¢˜ğŸ¢™ğŸ¢šğŸ¢›
# Arrows2:    â¤âœâ¤‡â¤†âŸµâŸµâŸ¶âŸ·âŸ¸âŸ¹â¬â¬â¬†â¬‡â¬…â¬â¬Œâ¬‹â¬Šâ¬‰â¬ˆâ­ â­¡â­¢â­£â­¤â­¥â­¦â­§â­¨â­©â­°â­±â­²â­³â¯‡â¯ˆâ¯†â¯…
# Arrows3:    â®œâ®â®â®Ÿâ¬â¬â¬â¬‘â®•â®¨â®©â®¬â®­â®®â®¯â®¨â®©â®ªâ®«â® â®¡â®¢â®£â®¤â®¥â®¦â®§â—¢â—£â—¤â—¥â—â—â—‘â—’â—“â—”â—•â—–â——â—„â–ºâ–²â–¼â—€â–¶â©âªâ«â¬â­â®â¯â´âµâ¶â·â¸â¹âº
# Others:     â–•â¦â¦‚â¦™â•â®¾â®¿â®‰â®‹â®ˆâ®Šâ®€â®â®‚â®ƒâ®„â®…â®†â®‡î€¤î€£î„‚'
#
# EOF
